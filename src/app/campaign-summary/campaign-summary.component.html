<div class="campaign-info">
  <app-campaign-summary-campaign-info></app-campaign-summary-campaign-info>
</div>

<div class="split-chart-container">
  <div class="ad-format-split-table">
    <div class="ad-format-split-table__header">
      <label>Ad Format Split</label>
    </div>
    <table
      mat-table
      class="data-table"
      *ngIf="(campaignSummary$ | async) as campaignSummary"
      [dataSource]="campaignSummaryByType$ | async">
      <!-- Type column -->
      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef>
          <span matTooltip="Type of keyword">
            Type
          </span>
        </th>
        <td mat-cell *matCellDef="let row">{{ capitalize(keywordTypesNames[row.type]) }}</td>
        <td mat-footer-cell *matFooterCellDef>Total</td>
      </ng-container>

      <!-- ARH column -->
      <ng-container matColumnDef="arh">
        <th mat-header-cell *matHeaderCellDef>
          <span matTooltip="Average Retail Health score of assigned products">
            ARH
          </span>
        </th>
        <td mat-cell *matCellDef="let row">
          {{ row.arh | number:'1.0-0':'fr-FR' }}
          <span *ngIf="!row.arh">-</span>
        </td>
        <td mat-footer-cell *matFooterCellDef>
          {{ campaignSummary.arh | number:'1.0-0':'fr-FR' }}
        </td>
      </ng-container>

      <!-- Sponsored Brand column -->
      <ng-container matColumnDef="brand">
        <th mat-header-cell class="border-left" *matHeaderCellDef>
          <span matTooltip="Sponsored Brands increases awareness of your products">
            Spon. Brand
          </span>
        </th>
        <td mat-cell class="border-left" *matCellDef="let row">
          <span class="currency-cell">{{ (currentCampaignCurrency$ | async)?.acronym }}</span>
          <span class="row-value">{{ (row.brand | number:'1.0-0':'fr-FR') || '-' }}</span>
        </td>
        <td mat-footer-cell class="border-left" *matFooterCellDef>
          <span class="currency-cell">{{ (currentCampaignCurrency$ | async)?.acronym }}</span>
          <span class="row-value">{{ campaignSummary.brand | number:'1.0-0':'fr-FR' }}</span>
        </td>
      </ng-container>

      <!-- Sponsored Product column -->
      <ng-container matColumnDef="product">
        <th mat-header-cell class="border-center" *matHeaderCellDef>
          <span matTooltip="Sponsored Products promotes the individual products you sell on Amazon">
            Spon. Product
          </span>
        </th>
        <td mat-cell class="border-center" *matCellDef="let row">
          <span class="currency-cell">{{ (currentCampaignCurrency$ | async)?.acronym }}</span>
          <span class="row-value">{{ (row.product | number:'1.0-0':'fr-FR') || '-' }}</span>
        </td>
        <td mat-footer-cell class="border-center" *matFooterCellDef>
          <span class="currency-cell">{{ (currentCampaignCurrency$ | async)?.acronym }}</span>
          <span class="row-value">{{ campaignSummary.product | number:'1.0-0':'fr-FR' }}</span>
        </td>
      </ng-container>

      <!-- Sponsored Product Display column -->
      <ng-container matColumnDef="productDisplay">
        <th mat-header-cell class="border-right" *matHeaderCellDef>
          <span
            matTooltip="Product Display Ads are product or interest targeted display ads that drive traffic to a product's detail page">
            Product Display Ad
          </span>
        </th>
        <td mat-cell class="border-right" *matCellDef="let row">
          <span class="currency-cell">{{ (currentCampaignCurrency$ | async)?.acronym }}</span>
          <span class="row-value">{{ (row.productDisplay | number:'1.0-0':'fr-FR') || '-' }}</span>
        </td>
        <td mat-footer-cell class="border-right" *matFooterCellDef>
          <span class="currency-cell">{{ (currentCampaignCurrency$ | async)?.acronym }}</span>
          <span class="row-value">{{ campaignSummary.productDisplay | number:'1.0-0':'fr-FR' }}</span>
        </td>
      </ng-container>

      <!-- Budget column -->
      <ng-container matColumnDef="budget">
        <th mat-header-cell *matHeaderCellDef>
          <span matTooltip="Planned monthly spend">
            Budget
          </span>
        </th>
        <td mat-cell *matCellDef="let row">
          <span class="currency-cell">{{ (currentCampaignCurrency$ | async)?.acronym }}</span>
          <span class="row-value row-value-budget">{{ (row.budget | number:'1.0-0':'fr-FR') || '-' }}</span>
        </td>
        <td mat-footer-cell *matFooterCellDef>
          <span class="currency-cell">{{ (currentCampaignCurrency$ | async)?.acronym }}</span>
          <span class="row-value row-value-budget">{{campaignSummary.budget | number:'1.0-0':'fr-FR' }}</span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns;"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      <tr mat-footer-row *matFooterRowDef="displayedColumns"></tr>
    </table>
  </div>

  <div class="strategy-chart">
    <div class="strategy-chart__header">
      <label>Strategy: {{ startCase((currentCampaign$ | async).strategy?.name) }}</label>
      <app-campaign-strategy-chart-legend></app-campaign-strategy-chart-legend>
    </div>
    <app-campaign-strategy-chart [strategyData]="selectedStrategyValuesByType$ | async"></app-campaign-strategy-chart>
  </div>
</div>

<mat-tab-group>
  <mat-tab label="Brand" [disabled]="!(brandKeywords$ | async).length">
    <ng-template mat-tab-label>
      <app-tab-header
        [errorCondition]="!(brandKeywords$ | async).length"
        errorMessage="There are no keywords specified"
        label="Brand"
        [counter]="getKeywordsOfTypeLength(keywordTypes.BRAND) | async">
      </app-tab-header>
    </ng-template>

    <app-loading-spinner *ngIf="(loadingKeywords$ | async)"></app-loading-spinner>
    <app-campaign-summary-keywords-list
      *ngIf="(keywords$ | async).length"
      [keywords]="(brandKeywords$ | async) | sortByCreation">
    </app-campaign-summary-keywords-list>
  </mat-tab>

  <mat-tab label="Generic" [disabled]="!(genericKeywords$ | async).length">
    <ng-template mat-tab-label>
      <app-tab-header
        [errorCondition]="!(genericKeywords$ | async).length"
        errorMessage="There are no keywords specified"
        label="Generic"
        [counter]="getKeywordsOfTypeLength(keywordTypes.GENERIC) | async">
      </app-tab-header>
    </ng-template>

    <app-campaign-summary-keywords-list
      *ngIf="(keywords$ | async).length"
      [keywords]="(genericKeywords$ | async) | sortByCreation">
    </app-campaign-summary-keywords-list>
  </mat-tab>

  <mat-tab label="Competitors" [disabled]="!(competitorKeywords$ | async).length">
    <ng-template mat-tab-label>
      <app-tab-header
        [errorCondition]="!(competitorKeywords$ | async).length"
        errorMessage="There are no keywords specified"
        label="Competitors"
        [counter]="getKeywordsOfTypeLength(keywordTypes.COMPETITOR) | async">
      </app-tab-header>
    </ng-template>

    <app-campaign-summary-keywords-list
      *ngIf="(keywords$ | async).length"
      [keywords]="(competitorKeywords$ | async) | sortByCreation">
    </app-campaign-summary-keywords-list>
  </mat-tab>
</mat-tab-group>

<div class="keywords-nav-buttons">
  <button mat-stroked-button color="primary" type="button" (click)="redirect('strategy')">
    <mat-icon matPrefix data-position="prefix">chevron_left</mat-icon>
    Prev
  </button>
  <button class="campaigns-button" mat-raised-button color="accent" type="button" (click)="redirect('campaigns')">
    Campaigns
    <mat-icon matSuffix data-position="suffix" svgIcon="back_arrow"></mat-icon>
  </button>
</div>
