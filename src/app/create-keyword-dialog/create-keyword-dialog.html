<div mat-dialog-title>
  <h1>Add keywords</h1>

  <button class="mat-dialog-title__close-button" matDialogClose matTooltip="Close dialog" aria-label="...">
    <mat-icon aria-label="Close">
      close
    </mat-icon>
  </button>
</div>

<div mat-dialog-content>
  <div class="keyword-input__wrapper">
    <mat-form-field appearance="outline" color="accent" class="keyword-input">
      <input matInput #keywordInput [maxLength]="maxNameLength"
        (keyup.enter)="addKeyword(keywordInput.value); keywordInput.value = ''" (paste)="paste($event)"
        placeholder="Add one or paste your keyword table here">
    </mat-form-field>
    <button mat-mini-fab [ngClass]="{ 'active': keywordInput.value }" [disabled]="!keywordInput.value"
      aria-label="Add keyword" (click)="addKeyword(keywordInput.value); keywordInput.value = ''">
      <mat-icon>add</mat-icon>
    </button>
  </div>

  <div class="keyword-list" id="list-names"
    *ngIf="keywords.length && !errorMessage && !keywordsHaveAdditionalParams(keywords)">
    <label class="chosen-keywords-label" for="list-names">Chosen keywords ({{ keywords.length }})</label>
    <div class="keyword-list__item" *ngFor="let keyword of keywords">
      {{ keyword.name }}
      <mat-icon class="keyword-list__item--delete" (click)="deleteKeyword(keyword.name)">cancel</mat-icon>
    </div>
  </div>
  <div class="keyword-list" id="list-table"
    *ngIf="keywords.length && !errorMessage && keywordsHaveAdditionalParams(keywords)">
    <label class="chosen-keywords-label" for="list-table">Chosen keywords ({{ keywords.length }})</label>
    <table mat-table [trackBy]="trackByFn" [dataSource]="keywords">

      <!-- Full keyword nName Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>
          <span matTooltip="Users search keyword phrase">
            Keyword
          </span>
        </th>
        <td mat-cell *matCellDef="let keyword">
          {{ keyword.name }}
        </td>
      </ng-container>

      <!-- Search Volume Column -->
      <ng-container matColumnDef="searchVolume">
        <th mat-header-cell *matHeaderCellDef>
          <span matTooltip="Number of keyword searches in Amazon">
            Search Vol.
          </span>
        </th>
        <td mat-cell *matCellDef="let keyword">
          {{ keyword.searchVolume || '-' }}
        </td>
      </ng-container>

      <!-- CTR Column -->
      <ng-container matColumnDef="ctr">
        <th mat-header-cell *matHeaderCellDef>
          <span matTooltip="Click Through Rate estimation">
            CTR
          </span>
        </th>
        <td mat-cell *matCellDef="let keyword">
          {{ keyword.ctr || '-' }}%
        </td>
      </ng-container>

      <!-- CPC Column -->
      <ng-container matColumnDef="cpc">
        <th mat-header-cell *matHeaderCellDef>
          <span matTooltip="Cost Per Click estimation">
            CPC
          </span>
        </th>
        <td mat-cell *matCellDef="let keyword">
          <div class="cpc-wrapper">
            <span class="currency-cell">{{ currency?.acronym }}</span>
            <span>{{ keyword.cpc || '-'}}</span>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="delete-button">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let keyword">
          <div class="delete-button-wrapper">
            <button mat-icon-button (click)="deleteKeyword(keyword.name)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>
  <div class="keyword-list" id="excel-mockup" *ngIf="!keywords.length && !errorMessage">
    <label class="chosen-keywords-label" for="excel-mockup">
      You may select range of cells from your Excel file and paste it in area above.
      <br>
      Remember to define headers exactly like on given example -
      <a href="../../assets/ShelfSpend_keywords_template.xlsx" target="_blank">click here to download Excel template</a>.
      <br>
      The order of columns can vary, but the column names must be exact.</label>
    <img src="/assets/images/shelfspend_keywords_excel_mockup.svg" alt="Mockup excel" width="100%">
  </div>
  <div class="keyword-list" *ngIf="errorMessage">
    <label class="chosen-keywords-label error">{{ errorMessage }}</label>
  </div>
</div>

<div *ngIf="keywords.length" class="products-wrapper">
  <img class="product-avatar" src="../../assets/icons/icon-product.svg" *ngFor="let product of this.selectedProducts"
    [matTooltip]="product.name" [class.priority]="product.priority">
  <button (click)="selectProducts()" mat-mini-fab class="add-assigned-products">
    <mat-icon>{{ this.selectedProducts.length ? 'edit' : 'add' }}</mat-icon>
  </button>
  <span>{{ !this.selectedProducts.length ? 'Assign products to keywords above' : 'Assigned products' }}</span>
</div>
<div mat-dialog-actions>
  <button mat-stroked-button color="primary" (click)="closeDialog()">Cancel
  </button>
  <div class="action-buttons">
    <span>Add keywords as a (choose one):</span>
    <div>
      <button mat-stroked-button color="{{ keywordsType === keywordTypes.BRAND ? 'accent' : 'primary' }}"
        (click)="setKeywordsType(keywordTypes.BRAND)">
        Brand
      </button>
      <button mat-stroked-button color="{{ keywordsType === keywordTypes.GENERIC ? 'accent' : 'primary' }}"
        (click)="setKeywordsType(keywordTypes.GENERIC)">
        Generic
      </button>
      <button mat-stroked-button color="{{ keywordsType === keywordTypes.COMPETITOR ? 'accent' : 'primary' }}"
        (click)="setKeywordsType(keywordTypes.COMPETITOR)">
        Competitors
      </button>
    </div>
    <button mat-raised-button color="accent" [disabled]="!keywords.length || !keywordsType" (click)="saveKeywords()">
      Add
    </button>
  </div>
</div>
